<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Web Alarm Pro</title>
    <style>
        :root { --primary: #007aff; --bg: #f2f2f7; --card: #ffffff; --text: #1c1c1e; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 500px; }
        h1 { font-size: 1.2rem; text-align: center; margin-bottom: 20px; color: #8e8e93; }
        #clock { font-size: 4rem; font-weight: 200; text-align: center; margin: 20px 0 40px 0; font-variant-numeric: tabular-nums; }
        
        /* 入力エリア */
        .add-box { background: var(--card); padding: 20px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 25px; display: flex; gap: 10px; }
        input[type="time"] { flex: 1; border: 1px solid #ddd; border-radius: 8px; padding: 10px; font-size: 1.2rem; outline: none; }
        .btn-add { background: var(--primary); color: white; border: none; border-radius: 8px; padding: 0 20px; font-weight: bold; cursor: pointer; }

        /* リストエリア */
        .alarm-item { background: var(--card); margin-bottom: 12px; padding: 15px 20px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 5px rgba(0,0,0,0.05); }
        .alarm-time { font-size: 1.5rem; font-weight: 500; }
        .btn-delete { background: #ff3b30; color: white; border: none; border-radius: 6px; padding: 8px 12px; cursor: pointer; }

        /* 全画面アラーム発動時 */
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--primary); color: white; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
        .stop-circle { width: 150px; height: 150px; border-radius: 50%; background: white; color: var(--primary); border: none; font-size: 1.5rem; font-weight: bold; cursor: pointer; box-shadow: 0 0 30px rgba(0,0,0,0.2); transition: transform 0.1s; }
        .stop-circle:active { transform: scale(0.9); }
    </style>
</head>
<body>

<div class="container">
    <h1>DIGITAL CLOCK</h1>
    <div id="clock">00:00:00</div>

    <div class="add-box">
        <input type="time" id="timeInput">
        <button class="btn-add" onclick="addAlarm()">追加</button>
    </div>

    <div id="alarmList"></div>
</div>

<div id="overlay">
    <h2 style="font-size: 2rem; margin-bottom: 30px;">アラーム鳴動中</h2>
    <button class="stop-circle" onclick="stopAlarm()">STOP</button>
</div>

<audio id="alarmSound" loop preload="auto">
    <source src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" type="audio/mpeg">
</audio>

<script>
    let alarms = JSON.parse(localStorage.getItem('saved_alarms')) || [];
    const audio = document.getElementById('alarmSound');
    const overlay = document.getElementById('overlay');

    function updateClock() {
        const now = new Date();
        const h = String(now.getHours()).padStart(2, '0');
        const m = String(now.getMinutes()).padStart(2, '0');
        const s = String(now.getSeconds()).padStart(2, '0');
        const timeStr = `${h}:${m}:${s}`;
        document.getElementById('clock').textContent = timeStr;

        // アラームチェック（秒が00の瞬間だけ判定）
        if (s === "00") {
            const currentHM = `${h}:${m}`;
            if (alarms.includes(currentHM)) {
                triggerAlarm();
            }
        }
    }

    function addAlarm() {
        const val = document.getElementById('timeInput').value;
        if (!val || alarms.includes(val)) return;
        
        alarms.push(val);
        alarms.sort();
        saveAndRender();
        
        // Median/iOS/Androidの自動再生制限対策
        audio.play().then(() => { audio.pause(); });
    }

    function deleteAlarm(time) {
        alarms = alarms.filter(a => a !== time);
        saveAndRender();
    }

    function saveAndRender() {
        localStorage.setItem('saved_alarms', JSON.stringify(alarms));
        const list = document.getElementById('alarmList');
        list.innerHTML = alarms.map(t => `
            <div class="alarm-item">
                <span class="alarm-time">${t}</span>
                <button class="btn-delete" onclick="deleteAlarm('${t}')">削除</button>
            </div>
        `).join('');
    }

    function triggerAlarm() {
        overlay.style.display = 'flex';
        audio.play();
        if (navigator.vibrate) {
            navigator.vibrate([1000, 500, 1000, 500, 1000]);
        }
    }

    function stopAlarm() {
        audio.pause();
        audio.currentTime = 0;
        overlay.style.display = 'none';
        if (navigator.vibrate) navigator.vibrate(0);
    }

    setInterval(updateClock, 1000);
    saveAndRender();
</script>
</body>
</html>
